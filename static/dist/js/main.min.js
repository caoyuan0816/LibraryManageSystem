function getUrlParam(e){var o=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(o);return null!=a?unescape(a[2]):null}function getUrlParam(e){var o=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(o);return null!=a?unescape(a[2]):null}function bookSearchAjax(e){$.post("/api/book-search/",e,function(e){if(console.log("book-search"),console.log(e),e.status){$(".book-dis").empty();for(var o=0;o<e.book_list.length;o++){var a='<li><a href="/book-detail/?bookid='+e.book_list[o].id+'"><img src="'+e.book_list[o].photoURL+'" alt=""/><p>'+e.book_list[o].bookName+"</p></a></li>";$(".book-dis").append(a)}var s=8,n=e.all_number,r=n/s;n%s!=0&&r++,$(".pagination").empty();for(var o=1;r>=o;o++){var t="<li><span>"+o+"</span></li>";$(".pagination").append(t)}}else alertFun("not found book!"),setTimeout(function(){$("#alertModal").modal("hide")},1200)})}function freshBookList(e){var o=getUrlParam("class"),a={};a.page=e,a.classify=o,bookSearchAjax(a)}function loginCheck(){return $("#loginForm").validate({rules:{username:{required:!0},password:{required:!0}},messages:{username:{required:"Username couldn't be null"},password:{required:"Password couldn't be null"}}})}function registCheck(){return $("#registForm").validate({rules:{schoolId:{required:!0,maxlength:10,minlength:10},registUsername:{required:!0},email:{required:!0,email:!0},registPassword:{required:!0,minlength:6,maxlength:20},conPassword:{required:!0,minlength:6,maxlength:20,equalTo:"#registPassword"}},messages:{schoolId:{required:"StudentID couldn't be null",maxlength:"The length of StudentID is 10",minlength:"The length of StudentID is 10"},registUsername:{required:"Nickname couldn't be null"},email:{required:"Email couldn't be null",email:"The format of email is incorrect"},registPassword:{required:"Password couldn't be null",minlength:"The minimum length of password is 6",maxlength:"The maximum length of password is 20"},conPassword:{required:"Password couldn't be null",minlength:"The minimum length of password is 6",maxlength:"The maximum length of password is 20",equalTo:"Please input the same password twice"}}})}function modifyPassCheck(){return $("#modifyForm").validate({rules:{oldPassword:{required:!0,minlength:6,maxlength:20},newPassword:{required:!0,minlength:6,maxlength:20},conNewPassword:{required:!0,minlength:6,maxlength:20,equalTo:"#newPassword"}},messages:{oldPassword:{required:"Password couldn't be null",minlength:"The minimum length of password is 6",maxlength:"The maximum length of password is 20"},newPassword:{required:"Password couldn't be null",minlength:"The minimum length of password is 6",maxlength:"The maximum length of password is 20"},conNewPassword:{required:"Password couldn't be null",minlength:"The minimum length of password is 6",maxlength:"The maximum length of password is 20",equalTo:"Please input the same password twice"}}})}function saveUserInf(){if($("#rmbUser").get(0).checked){var e=$("#username").val(),o=$("#password").val();$.cookie("rmbUserFlag","true",{expires:7}),$.cookie("username",e,{expires:7}),$.cookie("password",o,{expires:7})}else $.cookie("rmbUserFlag","false",{expires:-1}),$.cookie("username","",{expires:-1}),$.cookie("password","",{expires:-1});console.log($.cookie("username")),console.log($.cookie("password"))}function alertFun(e){$("#alertMsg").text(e),$("#alertModal").on("show.bs.modal",function(){console.log("alertModal");var e=$(this),o=e.find(".modal-dialog"),a=($(window).height()-o.height())/2;o.css({margin:a+"px auto"})}),$("#alertModal").modal("show")}function OnclickLogout(){$.post("/api/logout",function(e){var o="'",a=new RegExp(o,"g");e=e.replace(a,'"'),console.log(JSON.parse(e));var s=JSON.parse(e);"true"==s.status&&(alertFun("Logout Success!"),setTimeout("javascript:location.reload()",1200))})}function abc(){var e={};e.username="123",e.password="123",$.post("/api/login",e,function(e){console.log(e)})}$(function(){var e=getUrlParam("bookid");console.log(e),$.post("/api/book-detail/",{bookid:e},function(e){if(e.status){$(".book-content").empty();var o='<div class="row"><div class="col-sm-6 book-pho"><a href="'+e.book.photoURL+'"><img src="'+e.book.photoURL+'" alt=""/></a></div><div class="col-sm-6 book-inf"><p><span>书名：</span><span>'+e.book.bookName+"</span></p><p><span>作者：</span><span>"+e.book.author+"</span></p><p><span>出版社：</span><span>"+e.book.publisher+"</span></p><p><span>出版时间：</span><span>"+e.book.publishTime+"</span></p><p><span>ＩＳＢＮ码：</span><span>"+e.book.isbn+"</span></p><p><span>译者：</span><span>"+e.book.translator+"</span></p><p><span>现存量：</span><span>"+e.book.currentStorage+"</span></p><p>作者介绍：</p><p>"+e.book.authorIntroduction+'</p></div></div><div class="row book-intr"><h4>内容简介：</h4><pre>'+e.book.bookIntroduction+"</pre></div>";$(".book-content").append(o)}})}),$(function(){freshBookList(1),$(".pagination").on("click","span",function(e){e.preventDefault();var o=parseInt($(this).text());freshBookList(o)}),$("#searchBtn").on("click",function(e){e.preventDefault();var o={};o.page=1,o.type=$("#searchType").val(),o.value=$("#searchValue")[0].value,console.log(o),bookSearchAjax(o)})}),$(function(){"true"==$.cookie("rmbUserFlag")&&($("#rmbUser").attr("checked",!0),$("#username").val($.cookie("username")),$("#password").val($.cookie("password"))),$("#rmbUser").get(0).checked||($.cookie("rmbUserFlag","false",{expires:-1}),$.cookie("username","",{expires:-1}),$.cookie("password","",{expires:-1})),$("#login").click(function(){if(saveUserInf(),loginCheck().form()){var e={};e.username=$("#username")[0].value,e.password=$("#password")[0].value,$.post("/api/login",e,function(e){var o="'",a=new RegExp(o,"g");e=e.replace(a,'"'),console.log(JSON.parse(e));var s=JSON.parse(e);"true"==s.status?($("#loginModal").modal("hide"),alertFun("Login Success!"),setTimeout("javascript:location.reload()",1200)):($(".login-error").css({display:"block"}),$(".login-error").text(s.message))})}}),$("#regist").click(function(){if(registCheck().form()){var e={};e.email=$("#email")[0].value,e.username=$("#registUsername")[0].value,e.password=$("#conPassword")[0].value,console.log(e),$.post("/api/register/",e,function(e){console.log(e),e.status?($("#registModal").modal("hide"),alertFun("Regist Success!"),setTimeout(function(){$("#alertModal").modal("hide")},1200)):($(".regist-error").css({display:"block"}),$(".regist-error").text(e.message))})}}),$("#modify").on("click",function(){if(modifyPassCheck().form()){var e={};e.password=$("#oldPassword")[0].value,e.newpassword=$("#newPassword")[0].value,e.username=__username,console.log(e),$.post("/api/reset-password/",e,function(e){e.status?($("#modifyModal").modal("hide"),alertFun("Modify  Password Successfully!"),setTimeout(function(){$("#alertModal").modal("hide")},1200)):($(".modify-error").css({display:"block"}),$(".modify-error").text(e.message))})}}),$("#forgetBtn").on("click",function(e){$("#forgetBtn").attr("disabled","disabled");var o={};o.email=$("#email-input")[0].value,console.log(o),$.post("/api/forget-password/",o,function(e){e.status?(alertFun("Sent success! Please check your email:)"),setTimeout(function(){$("#alertModal").modal("hide"),window.location.href="http://test.yuan25.com"},1200)):($(".forget-inf").css({display:"block"}),$(".forget-inf").text(e.message))})}),$("#book-upload-button").on("click",function(e){var o={};o.bookname=$("#bookName").val(),o.author=$("#author").val(),o.publisher=$("#publisher").val(),o.publishtime=$("#publishTime").val(),o.isbn=$("#ISBN").val(),o.currentstorage=$("#currentStorage").val(),o.translator=$("#translator").val(),o.photoURL=$("#photoUrl").val(),o.authorintro=$("#authorIntroduction").val(),o.bookintro=$("#bookIntroduction").val(),$.post("/api/book-upload/",o,function(e){e.status?(alertFun(e.message),setTimeout(function(){$("#alertModal").modal("hide"),location.reload()},1200)):(alertFun(e.message),setTimeout(function(){$("#alertModal").modal("hide")},1200))})})}),$("document").ready(function(){});