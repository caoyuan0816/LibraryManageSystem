function getBookList(){var o={};o.page=1,o.classify="",o.type="",o.value="",$.post("/api/book-search/",o,function(o){if(o.status)for(var e=$("#manageBook"),a=0;a<o.book_list.length;a++){var r='<tr><td><img class="bookBarcode" id="'+o.book_list[a].id+'"/></td><td class="bookid">'+o.book_list[a].id+"</td><td>"+o.book_list[a].bookName+"</td><td>"+o.book_list[a].author+'</td><td><a data-toggle="modal" data-target=".modify-modal" class="modifyBook">modify</a><span> | </span><a class="deleteBook">delete</a></td></tr>';e.append(r)}})}function getBookBarcode(){var o=$(".bookBarcode");console.log(o);for(var e=0;e<o.length;e++)console.log(o[e].attributes("id").value)}function getUrlParam(o){var e=new RegExp("(^|&)"+o+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(e);return null!==a?unescape(a[2]):null}function getUrlParam(o){var e=new RegExp("(^|&)"+o+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(e);return null!=a?unescape(a[2]):null}function bookSearchAjax(o){$.post("/api/book-search/",o,function(o){if(o.status){$(".book-dis").empty();for(var e=0;e<o.book_list.length;e++){var a='<li><a href="/book-detail/?bookid='+o.book_list[e].id+'"><img src="'+o.book_list[e].photoURL+'" alt=""/><p>'+o.book_list[e].bookName+"</p></a></li>";$(".book-dis").append(a)}var r=8,t=o.all_number,s=t/r;t%r!=0&&s++,$(".pagination").empty();for(var e=1;s>=e;e++){var n="<li><span>"+e+"</span></li>";$(".pagination").append(n)}}else alertFun("not found book!"),setTimeout(function(){$("#alertModal").modal("hide")},1200)})}function freshBookList(o){var e={};e.page=o,e.classify="";var a=localStorage.getItem("globalSearchData"),r=JSON.parse(a);console.log(a),e.type=r.searchType,e.value=r.searchValue,bookSearchAjax(e)}function loginCheck(){return $("#loginForm").validate({rules:{username:{required:!0},password:{required:!0}},messages:{username:{required:"Username couldn't be null"},password:{required:"Password couldn't be null"}}})}function registCheck(){return $("#registForm").validate({rules:{schoolId:{required:!0,maxlength:10,minlength:10},registUsername:{required:!0},email:{required:!0,email:!0},registPassword:{required:!0,minlength:6,maxlength:20},conPassword:{required:!0,minlength:6,maxlength:20,equalTo:"#registPassword"}},messages:{schoolId:{required:"StudentID couldn't be null",maxlength:"The length of StudentID is 10",minlength:"The length of StudentID is 10"},registUsername:{required:"Nickname couldn't be null"},email:{required:"Email couldn't be null",email:"The format of email is incorrect"},registPassword:{required:"Password couldn't be null",minlength:"The minimum length of password is 6",maxlength:"The maximum length of password is 20"},conPassword:{required:"Password couldn't be null",minlength:"The minimum length of password is 6",maxlength:"The maximum length of password is 20",equalTo:"Please input the same password twice"}}})}function modifyPassCheck(){return $("#modifyForm").validate({rules:{oldPassword:{required:!0,minlength:6,maxlength:20},newPassword:{required:!0,minlength:6,maxlength:20},conNewPassword:{required:!0,minlength:6,maxlength:20,equalTo:"#newPassword"}},messages:{oldPassword:{required:"Password couldn't be null",minlength:"The minimum length of password is 6",maxlength:"The maximum length of password is 20"},newPassword:{required:"Password couldn't be null",minlength:"The minimum length of password is 6",maxlength:"The maximum length of password is 20"},conNewPassword:{required:"Password couldn't be null",minlength:"The minimum length of password is 6",maxlength:"The maximum length of password is 20",equalTo:"Please input the same password twice"}}})}function saveUserInf(){if($("#rmbUser").get(0).checked){var o=$("#username").val(),e=$("#password").val();$.cookie("rmbUserFlag","true",{expires:7}),$.cookie("username",o,{expires:7}),$.cookie("password",e,{expires:7})}else $.cookie("rmbUserFlag","false",{expires:-1}),$.cookie("username","",{expires:-1}),$.cookie("password","",{expires:-1});console.log($.cookie("username")),console.log($.cookie("password"))}function alertFun(o){$("#alertMsg").text(o),$("#alertModal").on("show.bs.modal",function(){console.log("alertModal");var o=$(this),e=o.find(".modal-dialog"),a=($(window).height()-e.height())/2;e.css({margin:a+"px auto"})}),$("#alertModal").modal("show")}function alertWithClose(o){alertFun(o),setTimeout(function(){$("#alertModal").modal("hide")},1500)}function OnclickLogout(){console.log("Fuck"),b,$.post("/api/logout",function(o){var e="'",a=new RegExp(e,"g");o=o.replace(a,'"'),console.log(JSON.parse(o));var r=JSON.parse(o);"true"==r.status?(alertFun("Logout Success!"),setTimeout("javascript:location.reload()",1500)):(alertFun("Logout defeat!"),setTimeout("javascript:location.reload()",1500))})}function abc(){var o={};o.username="123",o.password="123",$.post("/api/login",o,function(o){console.log(o)})}function freshCurrentRecords(){var o={};o.username=getUrlParam("username"),$.post("/api/current-records/",o,function(o){if(o.status)for(var e=$("#currentRecords"),a=0;a<o.records.length;a++){var r="<tr><td>"+o.records[a].bookid+"</td><td>"+o.records[a].bookName+"</td><td>"+o.records[a].author+"</td><td>"+o.records[a].borrowtime+"</td><td>"+o.records[a].actualreturntime+"</td></tr>";e.append(r)}else alertWithClose("load error");console.log(o)})}function freshHistoryRecords(){var o={};o.username=getUrlParam("username"),$.post("/api/history-records/",o,function(o){if(o.status){var e=$("#historyRecords");console.log(o);for(var a=0;a<o.records.length;a++){var r="<tr><td>"+o.records[a].bookid+"</td><td>"+o.records[a].bookName+"</td><td>"+o.records[a].author+"</td><td>"+o.records[a].borrowtime+"</td><td>"+o.records[a].actualreturntime+"</td></tr>";e.append(r)}}else alertWithClose("load error")})}function freshUserInformationPage(){var o={};o.username=getUrlParam("username"),$.post("/api/user/",o,function(o){$(".read-intr .borrowed span").text(o.borrowed),$(".read-intr .overdue span").text(o.overdue),$(".read-intr .accumlated span").text(o.accumulated)})}function feshUserFine(){var o={};o.username=getUrlParam("username"),$.post("/api/user-fine/",o,function(o){if(o.status){var e=$("#userFine");console.log(o);for(var a=0;a<o.records.length;a++){var r="<tr><td>"+o.records[a].bookid+"</td><td>"+o.records[a].bookName+"</td><td>"+o.records[a].author+"</td><td>"+o.records[a].borrowtime+"</td><td>"+o.records[a].actualreturntime+"</td><td>"+o.fines[a]+"</td></tr>";e.append(r)}}else alertWithClose("load error")})}$(function(){getBookList(),$("#manageBook").on("click","a",function(o){o.preventDefault();var e=$(this),a={};if(a["book-id"]=$(this).parent().siblings(".bookid").text(),"modifyBook"==$(this).attr("class")){var r={};r.bookname=$("#bookName").val(),r.author=$("#author").val(),r.publisher=$("#publisher").val(),r.publishtime=$("#publishTime").val(),r.isbn=$("#ISBN").val(),r.translator=$("#translator").val(),r.photoURL=$("#photoUrl").val(),r.authorintro=$("#authorIntroduction").val(),r.bookintro=$("#bookIntroduction").val(),$("#modifyBookBtn").on("click",function(o){o.preventDefault(),$.post("/api/modify-book/",r,function(o){o.status?(alertFun(o.message),setTimeout(function(){$("#alertModal").modal("hide"),location.reload()},1200)):alertWithClose(o.message)})})}else{var t=confirm("Do you really want to delete the book?");1==t&&$.post("/api/delete-book/",a,function(o){o.status?(e.parent().parent().hide("400"),alertWithClose("delete successfully")):alertWithClose("delete fail")})}})}),$(function(){var o=getUrlParam("bookid");console.log(o),$.post("/api/book-detail/",{bookid:o},function(o){if(o.status){$(".book-content").empty();var e='<div class="row"><div class="col-sm-6 book-pho"><a href="'+o.book.photoURL+'"><img src="'+o.book.photoURL+'" alt=""/></a></div><div class="col-sm-6 book-inf"><p style="font-size: 22px;"><span>书名：</span><span>'+o.book.bookName+"</span></p><p><span>作者：</span><span>"+o.book.author+"</span></p><p><span>出版社：</span><span>"+o.book.publisher+"</span></p><p><span>出版时间：</span><span>"+o.book.publishTime+"</span></p><p><span>ＩＳＢＮ码：</span><span>"+o.book.isbn+"</span></p><p><span>译者：</span><span>"+o.book.translator+"</span></p><p>作者介绍：</p><p>"+o.book.authorIntroduction+'</p></div></div><div class="row book-intr"><h4>内容简介：</h4><pre>'+o.book.bookIntroduction+"</pre></div>";$(".book-content").append(e)}})});var globalParas={};$(function(){var o=window.location.href;-1!=o.indexOf("book-search")&&freshBookList(1),$(".pagination").on("click","span",function(o){o.preventDefault();var e=parseInt($(this).text());paras={},globalParas.page=e,bookSearchAjax(globalParas)}),$("#categoryList").on("click","a",function(o){o.preventDefault(),globalParas.type="",globalParas.value="";var e={};e.classify=$(this).data("class"),e.page=1,globalParas.classify=e.classify,bookSearchAjax(e)}),$("#searchBtn").on("click",function(o){o.preventDefault();var e=window.location.href;if(e.indexOf("book-search"),console.log(e.indexOf("book-search")),-1!=e.indexOf("book-search")){console.log("ajax"),globalParas.classify="";var a={};a.page=1,a.type=$("#searchType").val(),a.value=$("#searchValue")[0].value,globalParas.type=a.type,globalParas.value=a.value,bookSearchAjax(a)}else{console.log("reload");var r={};r.searchType=$("#searchType").val(),r.searchValue=$("#searchValue")[0].value;var t=JSON.stringify(r);localStorage.setItem("globalSearchData",t),window.location.href="/book-search/"}}),$("#searchForm .form-group").keydown(function(o){13==o.keyCode&&$("#searchBtn").click()})}),$(function(){"true"==$.cookie("rmbUserFlag")&&($("#rmbUser").attr("checked",!0),$("#username").val($.cookie("username")),$("#password").val($.cookie("password"))),$("#rmbUser").get(0).checked||($.cookie("rmbUserFlag","false",{expires:-1}),$.cookie("username","",{expires:-1}),$.cookie("password","",{expires:-1})),$("#login").on("click",function(o){if(o.preventDefault(),saveUserInf(),loginCheck().form()){var e={};e.username=$("#username")[0].value,e.password=$("#password")[0].value,$.post("/api/login",e,function(o){var e="'",a=new RegExp(e,"g");o=o.replace(a,'"'),console.log(JSON.parse(o));var r=JSON.parse(o);"true"==r.status?($("#loginModal").modal("hide"),alertFun("Login Success!"),setTimeout("javascript:location.reload()",1500)):($(".login-error").css({display:"block"}),$(".login-error").text(r.message))})}}),$("#loginForm").keydown(function(o){console.log("keydown"),13==o.keyCode&&$("#login").click()}),$("#regist").on("click",function(o){if(o.preventDefault(),registCheck().form()){var e={};e.email=$("#email")[0].value,e.username=$("#registUsername")[0].value,e.password=$("#conPassword")[0].value,console.log(e),$.post("/api/register/",e,function(o){console.log(o),o.status?($("#registModal").modal("hide"),alertWithClose("Regist Success!")):($(".regist-error").css({display:"block"}),$(".regist-error").text(o.message))})}}),$("#registForm").keydown(function(o){13==o.keyCode&&$("#regist").click()}),$("#modify").on("click",function(){if(modifyPassCheck().form()){var o={};o.password=$("#oldPassword")[0].value,o.newpassword=$("#newPassword")[0].value,o.username=__username,console.log(o),$.post("/api/reset-password/",o,function(o){o.status?($("#modifyModal").modal("hide"),alertWithClose("Modify password successfully!")):($(".modify-error").css({display:"block"}),$(".modify-error").text(o.message))})}}),$("#forgetBtn").on("click",function(o){$("#forgetBtn").attr("disabled","disabled");var e={};e.email=$("#email-input")[0].value,console.log(e),$.post("/api/forget-password/",e,function(o){o.status?(alertFun("Sent success! Please check your email:)"),setTimeout(function(){$("#alertModal").modal("hide"),window.location.href="http://test.yuan25.com"},1200)):($(".forget-inf").css({display:"block"}),$(".forget-inf").text(o.message))})}),$("#book-upload-button").on("click",function(o){var e={};e.bookname=$("#bookName").val(),e.author=$("#author").val(),e.publisher=$("#publisher").val(),e.publishtime=$("#publishTime").val(),e.isbn=$("#ISBN").val(),e.translator=$("#translator").val(),e.photoURL=$("#photoUrl").val(),e.authorintro=$("#authorIntroduction").val(),e.bookintro=$("#bookIntroduction").val(),$.post("/api/book-upload/",e,function(o){o.status?(alertFun(o.message),setTimeout(function(){$("#alertModal").modal("hide"),location.reload()},1200)):alertWithClose(o.message)})})}),$("document").ready(function(){}),$(function(){$("#borrowForm #borrowBtn").on("click",function(o){o.preventDefault();var e={};e.username=$("#borrowUsername")[0].value,e["book-id"]=$("#isbn")[0].value,console.log(e),$.post("/api/borrow-book/",e,function(o){alertWithClose(o.message)})}),$("#borrowForm").keydown(function(o){13==o.keyCode&&$("#borrowForm #borrowBtn").click()}),$("#returnForm #returnBtn").on("click",function(o){o.preventDefault();var e={};e.username=$("#returnUsername")[0].value,e["book-id"]=$("#isbn")[0].value,console.log(e),$.post("/api/borrow-book/",e,function(o){console.log(o),alertWithClose(o.message)})}),$("#returnForm").keydown(function(o){13==o.keyCode&&$("#returnForm #returnBtn").click()})}),$(function(){var o=window.location.href;-1!=o.indexOf("current-records")&&freshCurrentRecords(),-1!=o.indexOf("history-records")&&freshHistoryRecords(),-1!=o.indexOf("user?")&&freshUserInformationPage(),-1!=o.indexOf("user-fine")&&feshUserFine()});